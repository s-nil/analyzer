/**
 * @file ObjectIntMapper.h
 * @author Sunil Singh (sunilp896@gmail.com)
 * @brief 
 * @version 0.1
 * @date 2020-01-21
 * 
 * @copyright Copyright (c) 2020
 * 
 */
#ifndef _A_OBJECT_INT_MAPPER_H_
#define _A_OBJECT_INT_MAPPER_H_
#include <vector>
#include "llvm/ADT/DenseMap.h"
#include "llvm/Support/raw_ostream.h"
#include "ValueUniverse"
#include "llvm/IR/Value.h"
#include <map>

namespace A
{
    /**
     * @brief 
     * 
     * @tparam T 
     */
    template<typename T>
    class ObjectIntMapper
    {
    public:
        ObjectIntMapper(){
            intToObject = std::vector<T>();
            objectToInt = std::map<T,int>();
            counter = 0;
        }
        
        ObjectIntMapper(ValueUniverse<T>& values){
            intToObject = std::vector<T>();
            objectToInt = std::map<T,int>();
            counter = 0;

            for(auto I = values.begin(), IE = values.end(); I != IE; ++I){
                Add(*I);
            }
            
        }
        ~ObjectIntMapper(){}

        int Add(T obj);
        int GetInt(T obj);
        T GetObject(int idx);
        bool Contains(T obj);
        int Size();

        bool operator==(ObjectIntMapper<T> rhs);
        bool operator!=(ObjectIntMapper<T> rhs); 
    private:
        std::vector<T> intToObject;
        int counter;
        // llvm::DenseMap<T,int> objectToInt; 
        std::map<T,int> objectToInt;
    };    
 
template<typename T>
int ObjectIntMapper<T>::Add(T obj){
    objectToInt[obj] = ++counter;
    intToObject.push_back(obj);
    return counter;
}

template<typename T>
int A::ObjectIntMapper<T>::GetInt(T obj){
    int i = objectToInt[obj];
    if(i != 0)
        return i-1;

    return Add(obj)-1;
}

template<typename T>
inline T A::ObjectIntMapper<T>::GetObject(int idx){
    return intToObject[idx];
}

template<typename T>
inline bool A::ObjectIntMapper<T>::Contains(T obj){
    if(objectToInt.find(obj) != objectToInt.end())
        return 1;
    return 0;
}

template<typename T>
inline int A::ObjectIntMapper<T>::Size(){
    return counter;
}

template<typename T>
inline bool A::ObjectIntMapper<T>::operator==(A::ObjectIntMapper<T> rhs){
    return intToObject == rhs.intToObject && counter == rhs.counter && objectToInt == rhs.objectToInt;
}

template<typename T>
inline bool A::ObjectIntMapper<T>::operator!=(A::ObjectIntMapper<T> rhs){
    return !operator==(rhs);
}
}

#endif